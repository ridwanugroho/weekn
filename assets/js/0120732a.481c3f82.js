"use strict";(self.webpackChunkweekn=self.webpackChunkweekn||[]).push([[1553],{1852:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/Api client auth with redis-d8147f3cac113112e7d7b2b64944e0c7.jpg"},6767:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"on-job-projects/Auth/web-api-token-redis","title":"Storing Web API client auth token in Redis","description":"alt text","source":"@site/docs/on-job-projects/Auth/1-web-api-token-redis.md","sourceDirName":"on-job-projects/Auth","slug":"/on-job-projects/Auth/web-api-token-redis","permalink":"/weekn/docs/on-job-projects/Auth/web-api-token-redis","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"onJobProjectSidebar","previous":{"title":"Single Sing On (SSO) Using Keycloak","permalink":"/weekn/docs/on-job-projects/Auth/sso-keycloak-overview"},"next":{"title":"Overview","permalink":"/weekn/docs/on-job-projects/Dealership System/overview"}}');var o=n(4848),r=n(8453);const s={},a="Storing Web API client auth token in Redis",c={},d=[];function l(e){const t={h1:"h1",header:"header",img:"img",li:"li",ol:"ol",p:"p",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"storing-web-api-client-auth-token-in-redis",children:"Storing Web API client auth token in Redis"})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"alt text",src:n(1852).A+"",width:"1587",height:"1138"})}),"\n",(0,o.jsx)(t.p,{children:"Many web api use Bearer token as their credential to a or some api endpoints. The request to generate token can be done in itself, or by other identity provider. But, the point that want we explain in this section is how we ask for token, and use it effectively."}),"\n",(0,o.jsx)(t.p,{children:"In my case, i use separate token generator (let say Keycloak \ud83d\ude04) than an endpoint in the api. Usually auth token generator endpoint provided by api it self as separate endpoint or sometime as new application. Due to security reason, generated token has limited valid time, usually in minutes. Once the token expired or invalid, targeted api will give Http response code 401 - Unauthorized, the api client should re-generate token then. Here is the basic approach :"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"Client request token"}),"\n",(0,o.jsx)(t.li,{children:"Client hit api and bring the generated token as credential"}),"\n",(0,o.jsx)(t.li,{children:"Api give responses"}),"\n",(0,o.jsx)(t.li,{children:"If token invalid, request token again"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Above sequence don\u2019t store the token. Client always request token everytime it will hit the api. This method isn\u2019t wrong, but inefective because the round trip when requesting token is costly. Instead of requesting token every request, i try to store it on Redis. Why redis? Why not host/server memory cache or database? Since modern app already dockerized running, the memorry rely on its replica. Once an app replicate, the new replica memory will not same as before. Storing temporary data in databse is also inefective i think, because you have to maintain expired data too. Redis will fit the requiremnt of \u201ctemporary\u201d and persistence between replicas. The point is :"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Request the token"}),"\n",(0,o.jsx)(t.li,{children:"Identify the token expire time"}),"\n",(0,o.jsx)(t.li,{children:"Add token to Redis with expiration = token expiration - n, where n is some number of minutes that you thik save as gap between token expiration and redis expiration. Make sure the redis is invalid before token expiration to prevent you app access the expired token."}),"\n",(0,o.jsx)(t.li,{children:"Once redis invalid, request new token, store again using same criteria mentioned before"}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>a});var i=n(6540);const o={},r=i.createContext(o);function s(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);